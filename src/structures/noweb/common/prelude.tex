%% prelude.tex
%%
%% KOMA needs it
\let\sf\sffamily
\let\bf\bfseries
\let\tt\ttfamily
\let\it\itshape
\let\rm\rmfamily

%% package for noweb
\usepackage{noweb}
\noweboptions{smallcode,longchunks,longxref}

%% fonts and encoding
\usepackage[T1]{fontenc}
\usepackage[default]{gillius}
\usepackage{CormorantGaramond}
\usepackage[zerostyle=d]{newtxtt}
\renewcommand{\familydefault}{\rmdefault}

\usepackage[utf8]{inputenc}
% Babel for French is known to break KOMA scripts
% \usepackage[french]{babel}

%% packages needed for section coloring
\usepackage{xcolor}
\usepackage{tikz}

%% hyperlinks initialisation
\definecolor{mygray}{rgb}{0.4,0.4,0.4}
\usepackage[bookmarks,backref=page,linkcolor=mygray]{hyperref} %,colorlinks
\hypersetup{%
  pdfauthor = {Bernard Tatin},
  pdftitle = {},
  pdfsubject = {},
  pdfkeywords = {},
  colorlinks=true,
  linkcolor= mygray,
  citecolor= black,
  pageanchor=true,
  urlcolor = mygray,
  plainpages = false,
  linktocpage
}

%% a better abstract (I hope...)
\renewenvironment{abstract}[1]{%
  \hfill
  \begin{minipage}
    {0.95\textwidth}
    \rule{\textwidth}{1pt}
    \footnotesize
    #1
    \normalsize
    {%
      \par\noindent
      \rule{\textwidth}{1pt}
    }
  \end{minipage}
}
%% format des paragraphes
%% \setlength{\parindent}{0cm}
%% \setlength{\parskip}{4mm}
%% \linespread{1.1}
%% \let\nwdocspar=\smallbreak

%% better itemize
\newenvironment{packed_itemize}{
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
}{\end{itemize}}

%% using parts, the beginning
% \makeatletter
% \let\old@part\@part
% \def\@part[#1]#2{\setcounter{section}{0}\old@part[#1]{#2\markboth{\MakeUppercase{\partname.\ #1}}{}}}
% \makeatother

%% colorized parts
\setkomafont{part}{\mypart}
\newcommand{\mypart}[1]{%
    \setcounter{section}{0}
    \huge\sffamily\bfseries%
    \color{white}%
    \setlength{\fboxsep}{0cm}%already boxed
    \colorbox{orange!40}{%
        \begin{minipage}{\linewidth}%
            \vspace*{4pt}%Space before
            \hspace*{3pt}
            #1
            \vspace*{4pt}%Space after
        \end{minipage}%
    }}

%% colorized sections
\setkomafont{section}{\mysection}
\newcommand{\mysection}[1]{%
    \LARGE\sffamily\bfseries%
    \color{white}%
    \setlength{\fboxsep}{0cm}%already boxed
    \colorbox{orange!80}{%
        \begin{minipage}{\linewidth}%
            \vspace*{4pt}%Space before
            \hspace*{3pt}
            #1
            \vspace*{4pt}%Space after
        \end{minipage}%
    }}

%% colorized subsections
\setkomafont{subsection}{\submysection}
\newcommand{\submysection}[1]{%
    \large\sffamily%
    \color{white}%
    \setlength{\fboxsep}{0cm}%already boxed
    \colorbox{orange!80}{%
        \begin{minipage}{\linewidth}%
            \vspace*{4pt}%Space before
            \hspace*{3pt}
            #1
            \vspace*{4pt}%Space after
        \end{minipage}%
    }}

%% colorized subsubsections
\setkomafont{subsubsection}{\subsubmysection}
\newcommand{\subsubmysection}[1]{%
    \itshape\sffamily%
    \color{white}%
    \setlength{\fboxsep}{0cm}%already boxed
    \colorbox{orange!80}{%
        \begin{minipage}{\linewidth}%
            \vspace*{4pt}%Space before
            \hspace*{3pt}
            #1
            \vspace*{4pt}%Space after
        \end{minipage}%
    }}
